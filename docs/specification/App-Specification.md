# 読書進捗管理 Flutter アプリ 仕様書

## 1. アプリケーション概要
本アプリケーションは、ユーザーの読書モチベーションを維持し、進捗を視覚的・感情的に応援・鼓舞することを目的とした Flutter アプリです。
「読書進捗応援」をテーマに、進捗度合いに応じた達成アニメーションや、デバッグ操作による応援・叱咤演出、インタラクティブなグラフを通じて豊かな読書体験を提供します。
※本プロジェクトは、ハンズオンを通したアニメーション実装の学習を目的としています。

## 2. 機能要件
このアプリケーションは、コード実装の学習を目的としています。
このため以下の制限を守る必要があります。
- build_runner を使ったコード生成を行いません。
- コードファイル名の末尾が .g.dart のようにコード生成ツールが使われている形跡があれば、問題があるとして、コード生成を行わない形式になるようやり直します。

### 2.1 書籍管理機能
- **書籍登録**: 読んでいる書籍のタイトルと総ページ数を設定して登録。
- **進捗更新**: 現在どこまで読み進めたか（読了ページ数）を記録。
- **感想記録**: 書籍に対する感想やメモを任意で保存。
- **書籍編集・削除**: 登録情報の修正および不要になった書籍の削除。

### 2.2 進捗視覚化機能
- **読書統計ドーナツチャート**:
    - 総ページ数に対する読了・残りの比率を円グラフで表示。
    - アニメーションによる滑らかな描画更新。
    - タップ時のパルスアニメーションと触覚フィードバック（Haptic Feedback）。
- **進捗統計情報表示**: 現在のページ数、残りページ数、達成率（%）をテキストで明示。

### 2.3 応援・演出機能
- **段階的進捗達成アニメーション**:
    - 読書進捗率の節目（10%, 50%, 80%, 100%）を跨いだ際に、達成を祝う豪華なアニメーション（星の演出、紙吹雪、メッセージなど）をオーバーレイ表示。
    - ※ 0% 時点の演出は行わず、10% 以降の節目で発火。
- **応援・叱咤シミュレーション**:
    - 設定画面のデバッグスイッチ操作により、10秒後に以下のいずれかの演出を擬似的に発火させる。
    - **応援 (Cheer)**: 「頑張って！」などの励ましメッセージと演出を表示。
    - **叱咤 (Scolding)**: 「もっと集中して！」などの鼓舞メッセージ（喝！）と演出を表示。
- **イベント発火のシミュレーション**: OSレベルの通知機能は利用せず、アプリ内イベントとして演出の動作確認・体験が可能。

## 3. 画面構成

### 3.1 ホーム画面 (`HomePage`)
- 登録されている書籍のカード一覧を表示。
- 画面全体に「進捗達成演出」および「応援・叱咤演出」が重なるレイヤー構造を持つ。
- 設定（新規登録）画面への遷移。

### 3.2 書籍詳細・進捗入力画面 (`ReadingBookPage`)
- 特定の書籍情報の表示および、読了ページ・感想の入力フォーム。
- 入力値のバリデーション機能。
- グラフ表示画面への遷移ボタンを配置。

### 3.3 読書進捗グラフ画面 (`ReadingBookGraphPage`)
- ドーナツチャートをメインとした進捗のフルスクリーン表示。
- インタラクティブな操作（タップ）によるフィードバック。

### 3.4 書籍新規登録画面 (`SettingsPage`) / 設定
- 新しい書籍を登録するための専用フォーム。
- デバッグ用の「読書開始/終了イベント」トグルスイッチ（演出シミュレーター）を配置。

## 4. 技術アーキテクチャ
レイヤード・アーキテクチャを採用し、
プレゼンテーション層の状態管理には MVVM を採用します。

### 4.1 コア技術スタック
- **Framework**: Flutter
- **State Management**: Riverpod (Notifier/Provider)
- **Navigation**: GoRouter (宣言的ルーティング、Named routes)
- **Design System**: Material 3

### 4.2 アプリケーション構造 (Layered Architecture)
- **Domain**: データの最小単位（`ValueObject`）やビジネスルールの定義。
- **Application**: グローバルな状態管理とユースケースの制御。
- **Presentation**: UI コンポーネントおよび画面単位の `ViewModel`。
- **Infrastructure**: ローカル保存や外部連携などの具象実装（将来拡張用）。
- **Fundamental**: ログ、ベースクラス、汎用ユーティリティ。

### 4.3 実行環境
- **Theme**: システム連動のライト/ダークモード対応。
- **Localization**: 国際化対応（i18n）の基盤。
- **Platform**: iOS / Android (macOS でのビルドを想定)。

## 5. テストと品質管理
- **ユニットテスト**: ビジネスロジックの検証。
- **Golden Test**: `golden_toolkit` を用いた UI コンポーネントのスナップショット検証。
- **インテグレーションテスト**: インタラクションに伴うアニメーションや状態変化の検証。

### 5.1 ユニット テスト
- 書籍情報登録: 書籍のタイトルと総ページ数をパラメータにして、  
  ユニークな書籍IDと読了ページ数が 0の書籍情報を新規作成し、書籍一覧に追加登録できること。
- 書籍情報更新: 書籍IDと読了ページ数をパラメータにして、  
  書籍一覧から書籍情報を取得し、書籍情報の読了ページ数（進捗）を更新できること。
- 書籍情報削除: 書籍IDをパラメータにして、書籍一覧から該当する書籍情報を削除できること。

### 5.1 Widget テスト
- ホーム画面 (`HomePage`)
  - 登録されている書籍のカード一覧が0件の場合。
    - カード一覧が表示されていないこと。
  - 登録されている書籍のカード一覧が2件の場合。
    - カード一覧に2件のカードが表示されていること。
  - 書籍のカード一覧のカードをタップした場合。
    - 書籍詳細・進捗入力画面に遷移すること。
    - 書籍名の入力フィールドにタップされたカードの書籍名が入っていること。
    - 進捗ページの入力フィールドにタップされたカードの進捗（読了ページ数）が入っていること。
  - アプリバーの設定（新規登録）アイコンをタップした場合。
    - 設定（新規登録）画面へ遷移すること。

- 書籍詳細・進捗入力画面 (`ReadingBookPage`)

- 読書進捗グラフ画面 (`ReadingBookGraphPage`)

- 書籍新規登録画面 (`SettingsPage`) 
